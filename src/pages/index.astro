---
import "../styles/global.css";
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body>
		<h1 class="heart-title">
			<span class="heart-text">Will you be my valentine?</span>
			<img src="/stitch.png" alt="Stitch" class="character character--left" />
			<img src="/angel.png" alt="Angel" class="character character--right" />
		</h1>
		<div class="choice-buttons">
			<button class="btn yes">Yes</button>
			<button class="btn no">No</button>
		</div>
		<audio id="valentine-sound" src="/valentine.mp3" preload="auto"></audio>
		<script>
			if (typeof window !== "undefined") {
				window.addEventListener("DOMContentLoaded", () => {
					const titleEl = document.querySelector(".heart-title");
					const titleText = document.querySelector(".heart-text");
					const yesBtn = document.querySelector(".btn.yes");
					const noBtn = document.querySelector(".btn.no");
					const choices = document.querySelector(".choice-buttons");
					const sound = document.querySelector("#valentine-sound");

					if (!titleEl || !titleText || !yesBtn || !noBtn || !choices) return;

					let resetTimeout;

					const moveButton = () => {
						const offsetX = (Math.random() - 0.5) * 400;
						const offsetY = (Math.random() - 0.5) * 200;

						noBtn.style.transition = "transform 0.15s ease";
						noBtn.style.transform = `translate(${offsetX}px, ${offsetY}px)`;

						clearTimeout(resetTimeout);
						resetTimeout = setTimeout(() => {
							noBtn.style.transform = "translate(0, 0)";
						}, 900);
					};

					const launchConfetti = () => {
						const colors = ["#ff4b8b", "#ffcf33", "#ffffff", "#ff8ba7"];
						const confettiCount = 220;

						for (let i = 0; i < confettiCount; i++) {
							const piece = document.createElement("div");
							piece.className = "confetti-piece";
							piece.style.left = `${Math.random() * 100}vw`;
							piece.style.backgroundColor = colors[i % colors.length];
							piece.style.animationDelay = `${Math.random() * 0.5}s`;
							document.body.appendChild(piece);
							setTimeout(() => piece.remove(), 3000);
						}
					};

					yesBtn.addEventListener("click", () => {
						titleText.textContent = "You are my Valentine now, I love you!";
						titleEl.classList.add("celebrate");
						choices.setAttribute("aria-hidden", "true");
						choices.style.opacity = "0";
						choices.style.pointerEvents = "none";
						launchConfetti();
						if (sound && typeof sound.play === "function") {
							try {
								sound.currentTime = 0;
								sound.play();
							} catch (e) {
								console.error(e);
							}
						}
					});

					["mouseenter", "mousedown", "touchstart"].forEach((eventName) => {
						noBtn.addEventListener(eventName, moveButton);
					});
				});
			}
		</script>
	</body>
</html>

